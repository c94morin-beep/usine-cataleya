<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion Production Multi-Listes - Sousou Fashion</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
        import { getDatabase, ref, get, set, update, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
        const firebaseConfig = {
            apiKey: "AIzaSyDVpN0cbCqDYI2klKrWqZJAcYDX2ayx8F0",
            authDomain: "usine-cataleya.firebaseapp.com",
            databaseURL: "https://usine-cataleya-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "usine-cataleya",
            storageBucket: "usine-cataleya.firebasestorage.app",
            messagingSenderId: "218489156781",
            appId: "1:218489156781:web:92f657e50e63222a130224"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        window.firebaseSignIn = (email, password) => signInWithEmailAndPassword(auth, email, password);
        window.firebaseSignOut = () => signOut(auth);
        window.firebaseOnAuthStateChanged = (cb) => onAuthStateChanged(auth, cb);
        window.firebaseGetUserRole = async (uid) => {
            const snapshot = await get(ref(db, 'users/' + uid + '/role'));
            return snapshot.exists() ? snapshot.val() : null;
        };
        window.firebaseSaveLists = async (lists) => {
            await set(ref(db, 'lists'), lists);
        };
        window.firebaseOnLists = (cb) => {
            return onValue(ref(db, 'lists'), (snapshot) => {
                cb(snapshot.exists() ? snapshot.val() : []);
            });
        };
        window.firebaseGetCasiers = async () => {
            const snapshot = await get(ref(db, 'casiers'));
            return snapshot.val() || {};
        };
        window.firebaseOnCasiers = (cb) => {
            return onValue(ref(db, 'casiers'), (snapshot) => {
                cb(snapshot.val() || {});
            });
        };
        window.firebaseSaveCasiers = async (data) => {
            await set(ref(db, 'casiers'), data);
        };
        window.firebaseMergeCasiers = async (newData) => {
            await update(ref(db, 'casiers'), newData);
        };
        window.firebaseUpdateCasier = async (key, data) => {
            await update(ref(db, 'casiers/' + key), data);
        };
        window.dispatchEvent(new Event('firebase-ready'));
    </script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Statuts
        const STATUTS = {
            EN_ATTENTE: 'En attente',
            TERMINE: 'Termin√©',
            RANGE: 'Rang√©',
            AVEC_COMMENTAIRE: 'Avec commentaire'
        };

        // Composant principal
        function App() {
            const [lists, setLists] = useState([]);
            const [activeListId, setActiveListId] = useState('global');
            const [activeTab, setActiveTab] = useState('dashboard');
            const [globalSelectedOrder, setGlobalSelectedOrder] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterStatus, setFilterStatus] = useState('all');
            const [showImportModal, setShowImportModal] = useState(false);
            const [completionAlert, setCompletionAlert] = useState(null); // {reference, client, autresCommandes[]}

            // Auth
            const [user, setUser] = useState(null);
            const [userRole, setUserRole] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);

            useEffect(() => {
                const init = () => {
                    window.firebaseOnAuthStateChanged(async (firebaseUser) => {
                        if (firebaseUser) {
                            const role = await window.firebaseGetUserRole(firebaseUser.uid);
                            setUser(firebaseUser); setUserRole(role);
                        } else { setUser(null); setUserRole(null); }
                        setAuthLoading(false);
                    });
                };
                if (window.firebaseOnAuthStateChanged) { init(); }
                else { window.addEventListener('firebase-ready', init); return () => window.removeEventListener('firebase-ready', init); }
            }, []);

            // Charger les donn√©es depuis Firebase en temps r√©el
            useEffect(() => {
                if (!user) return;
                const init = () => {
                    const unsub = window.firebaseOnLists((data) => {
                        setLists(Array.isArray(data) ? data : Object.values(data || {}));
                    });
                    return unsub;
                };
                if (window.firebaseOnLists) {
                    const unsub = init();
                    return () => unsub && unsub();
                } else {
                    window.addEventListener('firebase-ready', () => { init(); }, { once: true });
                }
            }, [user]);

            // Sauvegarder sur Firebase
            const saveLists = (newLists) => {
                setLists(newLists);
                const doSave = () => {
                    if (window.firebaseSaveLists) {
                        console.log('Sauvegarde Firebase...', newLists.length, 'listes');
                        window.firebaseSaveLists(newLists)
                            .then(() => console.log('Firebase OK'))
                            .catch(e => console.error('Firebase ERREUR:', e));
                    } else {
                        console.warn('firebaseSaveLists pas encore dispo, retry...');
                        setTimeout(doSave, 500);
                    }
                };
                doSave();
            };

            // Obtenir toutes les commandes (pour la vue globale)
            const getAllOrders = () => {
                return lists.flatMap(list => list.orders);
            };

            // Obtenir les commandes de la liste active
            const getActiveOrders = () => {
                if (activeListId === 'global') {
                    return getAllOrders();
                }
                const activeList = lists.find(l => l.id === activeListId);
                return activeList ? activeList.orders : [];
            };

            // Calculer les stats
            const calculateStats = (orders) => {
                return {
                    total: orders.length,
                    enAttente: orders.filter(o => o.status === STATUTS.EN_ATTENTE).length,
                    termines: [...new Set(orders.map(o => o.reference))].filter(ref => 
                        orders.filter(o => o.reference === ref).every(o => o.status === STATUTS.TERMINE)
                    ).length,
                    avecCommentaire: [...new Set(orders.filter(o => o.commentaires && o.commentaires.trim() !== '').map(o => o.reference))].length
                };
            };

            // Import nouvelle liste
            const handleImportNewList = (listName, file) => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const text = event.target.result;
                        const lines = text.split('\n');
                        
                        if (lines.length < 2) {
                            alert('Fichier CSV vide ou invalide');
                            return;
                        }
                        
                        // Parser le CSV manuellement (format avec point-virgule)
                        const headers = lines[0].split(';').map(h => h.trim());
                        console.log('En-t√™tes CSV:', headers); // Debug
                        const data = [];
                        
                        for (let i = 1; i < lines.length; i++) {
                            if (!lines[i].trim()) continue;
                            
                            const values = lines[i].split(';');
                            console.log('Ligne', i, ':', values); // Debug
                            
                            if (values.length >= 9) {
                                const row = {
                                    reference: values[0]?.replace(/"/g, '').trim() || '',
                                    name: values[1]?.replace(/"/g, '').trim() || '',
                                    url_image: values[2]?.replace(/"/g, '').trim() || '',
                                    total: values[3]?.replace(/"/g, '').trim() || '1',
                                    client: values[4]?.replace(/"/g, '').trim() || '',
                                    adresse_livraison: values[5]?.replace(/"/g, '').trim() || '',
                                    telephone: values[6]?.replace(/"/g, '').trim() || '',
                                    email: values[7]?.replace(/"/g, '').trim() || '',
                                    transporteur: values[8]?.replace(/"/g, '').trim() || ''
                                };
                                data.push(row);
                            }
                        }

                        const transformedData = data.map((row, index) => ({
                            id: `${Date.now()}-${index}`,
                            reference: row.reference,
                            name: row.name,
                            url_image: row.url_image,
                            commentaires: '',
                            quantity: parseInt(row.total) || 1,
                            status: STATUTS.EN_ATTENTE,
                            client: row.client,
                            adresse_livraison: row.adresse_livraison,
                            telephone: row.telephone,
                            email: row.email,
                            transporteur: row.transporteur
                        }));

                        const newList = {
                            id: `list-${Date.now()}`,
                            name: listName,
                            createdAt: new Date().toISOString(),
                            orders: transformedData
                        };

                        const updatedLists = [...lists, newList];
                        saveLists(updatedLists);
                        setActiveListId(newList.id);
                        setShowImportModal(false);
                        alert(`‚úÖ ${transformedData.length} articles import√©s dans "${listName}" !`);
                    } catch (error) {
                        console.error('Erreur import:', error);
                        alert('‚ùå Erreur lors de l\'importation : ' + error.message);
                    }
                };
                reader.readAsText(file, 'UTF-8');
            };

            // Supprimer une liste
            const deleteList = (listId) => {
                if (confirm('Voulez-vous vraiment supprimer cette liste ?')) {
                    const updatedLists = lists.filter(l => l.id !== listId);
                    saveLists(updatedLists);
                    if (activeListId === listId) {
                        setActiveListId('global');
                    }
                }
            };

            // Mettre √† jour un statut
            const updateStatus = (orderId, newStatus, newCommentaires) => {
                const updatedLists = lists.map(list => ({
                    ...list,
                    orders: list.orders.map(order =>
                        order.id === orderId 
                            ? { ...order, status: newStatus, commentaires: newCommentaires !== undefined ? newCommentaires : order.commentaires } 
                            : order
                    )
                }));
                saveLists(updatedLists);

                // Afficher la popup √† chaque fois qu'un article est termin√©
                if (newStatus === STATUTS.TERMINE) {
                    const allOrders = updatedLists.flatMap(l => l.orders);
                    const thisOrder = allOrders.find(o => o.id === orderId);
                    if (thisOrder) {
                        const ref = thisOrder.reference;
                        const client = thisOrder.client;
                        const email = thisOrder.email;
                        const articlesCommande = allOrders.filter(o => o.reference === ref);
                        const total = articlesCommande.length;
                        const termines = articlesCommande.filter(o => o.status === STATUTS.TERMINE).length;
                        const tousTermines = termines === total;
                        const autresCommandes = [...new Set(
                            allOrders
                                .filter(o => 
                                    o.reference !== ref &&
                                    o.status !== STATUTS.TERMINE &&
                                    (o.client === client || (email && o.email === email))
                                )
                                .map(o => o.reference)
                        )];

                        // V√©rifier si toutes les commandes de cette cliente sont termin√©es
                        let toutesCommandesTerminees = false;
                        let toutesCommandes = [];
                        if (tousTermines && autresCommandes.length === 0) {
                            // R√©cup√©rer toutes les commandes de cette cliente (termin√©es)
                            const tousRefs = [...new Set(
                                allOrders
                                    .filter(o => o.client === client || (email && o.email === email))
                                    .map(o => o.reference)
                            )];
                            if (tousRefs.length >= 2) {
                                // V√©rifier que toutes sont bien termin√©es
                                const toutesOk = tousRefs.every(r =>
                                    allOrders.filter(o => o.reference === r).every(o => o.status === STATUTS.TERMINE)
                                );
                                if (toutesOk) {
                                    toutesCommandesTerminees = true;
                                    toutesCommandes = tousRefs.sort((a,b) => b - a).map(r => ({
                                        reference: r,
                                        nbArticles: allOrders.filter(o => o.reference === r).length
                                    }));
                                }
                            }
                        }

                        setCompletionAlert({ reference: ref, client, autresCommandes, termines, total, tousTermines, toutesCommandesTerminees, toutesCommandes });
                    }

                // Allumer la LED automatiquement quand article termin√©
                if (newStatus === STATUTS.TERMINE) {
                    const allOrders2 = updatedLists.flatMap(l => l.orders);
                    const thisOrder2 = allOrders2.find(o => o.id === orderId);
                    if (thisOrder2) {
                        const ref2 = thisOrder2.reference;
                        // Chercher le casier correspondant et l'allumer
                        window.firebaseGetCasiers().then(casiers => {
                            const entry = Object.entries(casiers).find(([, v]) => String(v.commande) === String(ref2));
                            if (entry) {
                                window.firebaseUpdateCasier(entry[0], { allume: true });
                            }
                        });
                    }
                }

                // √âteindre la LED automatiquement quand tous les articles sont rang√©s
                if (newStatus === STATUTS.RANGE) {
                    const allOrders3 = updatedLists.flatMap(l => l.orders);
                    const thisOrder3 = allOrders3.find(o => o.id === orderId);
                    if (thisOrder3) {
                        const ref3 = thisOrder3.reference;
                        const articlesCommande3 = allOrders3.filter(o => o.reference === ref3);
                        const tousRanges = articlesCommande3.every(o => o.id === orderId ? true : o.status === STATUTS.RANGE);
                        if (tousRanges) {
                            window.firebaseGetCasiers().then(casiers => {
                                const entry = Object.entries(casiers).find(([, v]) => String(v.commande) === String(ref3));
                                if (entry) {
                                    window.firebaseUpdateCasier(entry[0], { allume: false });
                                }
                            });
                        }
                    }
                }
            };

            // Mettre √† jour un commentaire
            const updateComment = (orderId, newComment) => {
                const updatedLists = lists.map(list => ({
                    ...list,
                    orders: list.orders.map(order =>
                        order.id === orderId ? { ...order, commentaires: newComment } : order
                    )
                }));
                saveLists(updatedLists);
            };

            const activeOrders = getActiveOrders();
            const stats = calculateStats(activeOrders);

            // Fonction globale pour ouvrir la fiche commande avec bordereau Mondial Relay + Packlink
            const openGlobalOrderRecap = async (reference) => {
                const orderItems = activeOrders.filter(o => o.reference === reference);
                if (orderItems.length === 0) return;
                setGlobalSelectedOrder({
                    reference,
                    client: orderItems[0].client,
                    adresse_livraison: orderItems[0].adresse_livraison,
                    telephone: orderItems[0].telephone,
                    email: orderItems[0].email,
                    transporteur: orderItems[0].transporteur,
                    items: orderItems,
                    labelUrl: null, trackingUrl: null, expeditionNum: null,
                    packlinkUrl: null, packlinkRef: null,
                    loadingShipping: true
                });
                try {
                    // Chercher Mondial Relay ET Packlink en parall√®le
                    const [relayRes, packlinkRes] = await Promise.all([
                        fetch(`https://cataleyaparis.com/get_relay_token.php?id_order=${reference}`).then(r => r.json()).catch(() => null),
                        fetch(`https://cataleyaparis.com/get_packlink_label.php?id_order=${reference}`).then(r => r.json()).catch(() => null)
                    ]);
                    setGlobalSelectedOrder(prev => prev ? {
                        ...prev,
                        labelUrl: relayRes?.success ? relayRes.label_url : null,
                        trackingUrl: relayRes?.success ? relayRes.tracking_url : null,
                        expeditionNum: relayRes?.success ? relayRes.expedition_num : null,
                        packlinkUrl: packlinkRes?.success ? packlinkRes.label_url : null,
                        packlinkTrackingUrl: packlinkRes?.success ? packlinkRes.tracking_url : null,
                        packlinkRef: packlinkRes?.success ? packlinkRes.shipment_ref : null,
                        packlinkTrackingNumber: packlinkRes?.success ? packlinkRes.tracking_number : null,
                        packlinkCarrier: packlinkRes?.success ? packlinkRes.carrier : null,
                        loadingShipping: false
                    } : null);
                } catch(e) {
                    setGlobalSelectedOrder(prev => prev ? { ...prev, loadingShipping: false } : null);
                }
            };

            // Filtrer les commandes
            const filteredOrders = activeOrders.filter(order => {
                const matchSearch = order.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                  order.reference.toString().includes(searchTerm);
                const matchStatus = filterStatus === 'all' || order.status === filterStatus;
                return matchSearch && matchStatus;
            }).sort((a, b) => a.name.localeCompare(b.name));

            if (authLoading) return (
                <div className="min-h-screen flex items-center justify-center">
                    <p className="text-gray-500 text-lg">Chargement...</p>
                </div>
            );
            if (!user) return <LoginPage />;
            const isAdmin = userRole === 'admin';

            return (
                <div className="min-h-screen">
                    {/* Modal Fiche Commande Globale */}
                    {globalSelectedOrder && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[75] p-4" onClick={() => setGlobalSelectedOrder(null)}>
                            <div className="bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                <div className="sticky top-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-lg">
                                    <div className="flex justify-between items-start">
                                        <div className="flex-1">
                                            <h3 className="text-2xl font-bold mb-3">üì¶ Commande #{globalSelectedOrder.reference}</h3>
                                            <div className="space-y-2 text-blue-100">
                                                {globalSelectedOrder.client && <p className="flex items-start gap-2"><span className="text-lg">üë§</span><span className="font-semibold">{globalSelectedOrder.client}</span></p>}
                                                {globalSelectedOrder.adresse_livraison && <p className="flex items-start gap-2"><span className="text-lg">üìç</span><span>{globalSelectedOrder.adresse_livraison}</span></p>}
                                                {globalSelectedOrder.telephone && <p className="flex items-start gap-2"><span className="text-lg">üìû</span><a href={`tel:${globalSelectedOrder.telephone}`} className="hover:underline">{globalSelectedOrder.telephone}</a></p>}
                                                {globalSelectedOrder.email && <p className="flex items-start gap-2"><span className="text-lg">‚úâÔ∏è</span><a href={`mailto:${globalSelectedOrder.email}`} className="hover:underline">{globalSelectedOrder.email}</a></p>}
                                                {globalSelectedOrder.transporteur && <p className="flex items-start gap-2"><span className="text-lg">üöö</span><span>{globalSelectedOrder.transporteur}</span></p>}
                                                {/* Boutons bordereau dans le header */}
                                                {!globalSelectedOrder.loadingShipping && (
                                                    <div className="flex gap-2 flex-wrap mt-2">
                                                        {globalSelectedOrder.labelUrl && <a href={globalSelectedOrder.labelUrl} target="_blank" rel="noopener noreferrer" className="flex items-center gap-1 px-3 py-1.5 bg-white bg-opacity-20 hover:bg-opacity-30 text-white text-xs font-semibold rounded-lg transition">üìÑ √âtiquette MR</a>}
                                                        {globalSelectedOrder.trackingUrl && <a href={globalSelectedOrder.trackingUrl} target="_blank" rel="noopener noreferrer" className="flex items-center gap-1 px-3 py-1.5 bg-white bg-opacity-20 hover:bg-opacity-30 text-white text-xs font-semibold rounded-lg transition">üîç Suivi MR</a>}
                                                        {globalSelectedOrder.packlinkUrl && <a href={globalSelectedOrder.packlinkUrl} target="_blank" rel="noopener noreferrer" className="flex items-center gap-1 px-3 py-1.5 bg-orange-400 hover:bg-orange-500 text-white text-xs font-semibold rounded-lg transition">üìÑ √âtiquette {globalSelectedOrder.packlinkCarrier || 'Packlink'}</a>}
                                                        {globalSelectedOrder.packlinkTrackingUrl && <a href={globalSelectedOrder.packlinkTrackingUrl} target="_blank" rel="noopener noreferrer" className="flex items-center gap-1 px-3 py-1.5 bg-white bg-opacity-20 hover:bg-opacity-30 text-white text-xs font-semibold rounded-lg transition">üîç Suivi {globalSelectedOrder.packlinkTrackingNumber || 'colis'}</a>}
                                                        {globalSelectedOrder.loadingShipping === false && !globalSelectedOrder.labelUrl && !globalSelectedOrder.packlinkUrl && null}
                                                    </div>
                                                )}
                                                {globalSelectedOrder.loadingShipping && <p className="text-blue-200 text-xs mt-2">‚è≥ Recherche bordereau...</p>}
                                            </div>
                                        </div>
                                        <button onClick={() => setGlobalSelectedOrder(null)} className="text-white hover:text-gray-200 text-2xl font-bold">‚úï</button>
                                    </div>
                                </div>
                                <div className="p-6">
                                    <h4 className="font-semibold text-gray-700 mb-4 text-lg">Articles ({globalSelectedOrder.items.length})</h4>
                                    <div className="space-y-3">
                                        {globalSelectedOrder.items.map((item) => (
                                            <div key={item.id} className="flex items-start gap-4 p-4 bg-gray-50 rounded-lg">
                                                {item.url_image && <img src={item.url_image} alt={item.name} className="w-20 h-20 object-cover rounded border" onError={e => e.target.style.display='none'} />}
                                                <div className="flex-1">
                                                    <h5 className="font-semibold text-gray-900">{item.name}</h5>
                                                    <div className="mt-2 flex flex-wrap items-center gap-2">
                                                        <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold">Qt√©: {item.quantity || 1}</span>
                                                        <span className={`px-3 py-1 rounded-full text-sm font-semibold ${item.status === 'Rang√©' ? 'bg-purple-100 text-purple-700' : item.status === 'Termin√©' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`}>{item.status}</span>
                                                    </div>
                                                    {item.commentaires && <p className="mt-2 text-sm text-purple-600 italic">üí¨ {item.commentaires}</p>}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="mt-6 pt-4 border-t border-gray-200 flex justify-between items-center">
                                        <span className="font-semibold text-gray-700">Total articles:</span>
                                        <span className="text-2xl font-bold text-blue-600">{globalSelectedOrder.items.length}</span>
                                    </div>

                                </div>
                            </div>
                        </div>
                    )}
                    {/* Popup Commande Compl√®te */}
                    {completionAlert && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] p-4" onClick={() => setCompletionAlert(null)}>
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6" onClick={e => e.stopPropagation()}>
                                <div className="text-center mb-4">
                                    {completionAlert.tousTermines ? (
                                        <>
                                            <div className="text-5xl mb-3">üéâ</div>
                                            <h3 className="text-xl font-bold text-green-700">Commande #{completionAlert.reference} compl√®te !</h3>
                                            <p className="text-gray-500 text-sm mt-1">Tous les articles sont pr√™ts pour l'envoi.</p>
                                        </>
                                    ) : (
                                        <>
                                            <div className="text-5xl mb-3">‚úÖ</div>
                                            <h3 className="text-xl font-bold text-blue-700">Article termin√© ‚Äî Commande #{completionAlert.reference}</h3>
                                            <p className="text-gray-500 text-sm mt-1">
                                                <span className="font-bold text-green-600">{completionAlert.termines}</span> / {completionAlert.total} articles termin√©s ‚Äî il en reste <span className="font-bold text-orange-500">{completionAlert.total - completionAlert.termines}</span>
                                            </p>
                                            <div className="w-full bg-gray-100 rounded-full h-3 mt-3">
                                                <div className="bg-orange-400 h-3 rounded-full transition-all" style={{width: `${Math.round((completionAlert.termines / completionAlert.total) * 100)}%`}}></div>
                                            </div>
                                            <p className="text-xs text-gray-400 mt-1">{Math.round((completionAlert.termines / completionAlert.total) * 100)}%</p>
                                        </>
                                    )}
                                </div>
                                {completionAlert.toutesCommandesTerminees ? (
                                    <div className="bg-green-50 border-2 border-green-400 rounded-xl p-4 mt-2">
                                        <p className="text-green-800 font-bold text-sm mb-3">üöÄ Toutes les commandes de {completionAlert.client} sont pr√™tes !</p>
                                        <div className="space-y-2">
                                            {completionAlert.toutesCommandes.map(c => (
                                                <div key={c.reference} className="flex items-center justify-between bg-white border border-green-200 rounded-lg px-3 py-2">
                                                    <span className="font-mono font-bold text-green-800">#{c.reference}</span>
                                                    <span className="text-xs text-gray-500">{c.nbArticles} article(s)</span>
                                                    <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full">‚úÖ Pr√™t</span>
                                                </div>
                                            ))}
                                        </div>
                                        <p className="text-green-700 font-semibold text-sm mt-3 text-center">üì¶ Vous pouvez tout envoyer ensemble !</p>
                                    </div>
                                ) : completionAlert.autresCommandes.length > 0 ? (
                                    <div className="bg-orange-50 border border-orange-200 rounded-xl p-4 mt-4">
                                        <p className="text-orange-700 font-semibold text-sm">
                                            ‚ö†Ô∏è {completionAlert.client} a aussi {completionAlert.autresCommandes.length} autre(s) commande(s) en cours :
                                        </p>
                                        <div className="flex flex-wrap gap-2 mt-2">
                                            {completionAlert.autresCommandes.map(ref => (
                                                <span key={ref} className="font-mono text-sm bg-orange-100 text-orange-800 px-3 py-1 rounded-full font-semibold">#{ref}</span>
                                            ))}
                                        </div>
                                        <p className="text-orange-600 text-xs mt-2">üí° Pensez √† regrouper l'envoi !</p>
                                    </div>
                                ) : null}
                                <button
                                    onClick={() => setCompletionAlert(null)}
                                    className="mt-5 w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-xl transition"
                                >
                                    OK, compris !
                                </button>
                            </div>
                        </div>
                    )}
                    {/* Header */}
                    <header className="bg-gradient-to-r from-green-600 to-emerald-600 text-white shadow-lg">
                        <div className="container mx-auto px-6 py-4 flex justify-between items-center">
                            <div>
                                <h1 className="text-xl md:text-3xl font-bold">üì¶ Gestion Production</h1>
                                <p className="text-green-100 text-xs md:text-sm hidden sm:block">Sousou Fashion - Suivi multi-listes</p>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="text-right">
                                    <p className="text-xs md:text-sm font-semibold truncate max-w-32 md:max-w-none">{user.email}</p>
                                    <span className={`text-xs px-2 py-0.5 rounded-full font-semibold ${isAdmin ? 'bg-yellow-300 text-yellow-900' : 'bg-white bg-opacity-30 text-white'}`}>
                                        {isAdmin ? 'üîë Admin' : 'üëÅ Lecture'}
                                    </span>
                                </div>
                                <button onClick={() => window.firebaseSignOut()} className="px-2 md:px-3 py-1 md:py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg text-xs md:text-sm font-semibold transition">
                                    D√©connexion
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Navigation Listes */}
                    <nav className="bg-white border-b border-gray-200 sticky top-0 z-10 shadow-sm">
                        <div className="container mx-auto px-6">
                            <div className="flex items-center gap-2 overflow-x-auto py-2">
                                {/* Onglet Global */}
                                <button
                                    onClick={() => setActiveListId('global')}
                                    className={`px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition ${
                                        activeListId === 'global'
                                            ? 'bg-blue-100 text-blue-700 border-2 border-blue-300'
                                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    üìÇ GLOBAL ({getAllOrders().length})
                                </button>

                                {/* Onglets des listes */}
                                {lists.map(list => (
                                    <div key={list.id} className="flex items-center gap-1">
                                        <button
                                            onClick={() => setActiveListId(list.id)}
                                            className={`px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition ${
                                                activeListId === list.id
                                                    ? 'bg-green-100 text-green-700 border-2 border-green-300'
                                                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                            }`}
                                        >
                                            üìã {list.name} ({list.orders.length})
                                        </button>
                                        {isAdmin && <button onClick={() => deleteList(list.id)} className="px-2 py-2 text-red-600 hover:bg-red-50 rounded" title="Supprimer cette liste">‚úï</button>}
                                    </div>
                                ))}

                                {isAdmin && <button onClick={() => setShowImportModal(true)} className="px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition whitespace-nowrap">‚ûï Nouvelle liste</button>}
                            </div>
                        </div>
                    </nav>

                    {/* Modal Import */}
                    {showImportModal && (
                        <ImportModal
                            onImport={handleImportNewList}
                            onClose={() => setShowImportModal(false)}
                        />
                    )}

                    {/* Tabs */}
                    <nav className="bg-white border-b border-gray-200">
                        <div className="container mx-auto px-6">
                            <div className="flex gap-1">
                                <TabButton
                                    active={activeTab === 'dashboard'}
                                    onClick={() => setActiveTab('dashboard')}
                                    icon="üìä"
                                    label="Dashboard"
                                />
                                <TabButton
                                    active={activeTab === 'production'}
                                    onClick={() => setActiveTab('production')}
                                    icon="‚úÇÔ∏è"
                                    label="Suivi Production"
                                />
                                <TabButton
                                    active={activeTab === 'orders'}
                                    onClick={() => setActiveTab('orders')}
                                    icon="üîç"
                                    label="Par Commande"
                                />
                                <TabButton
                                    active={activeTab === 'multiorders'}
                                    onClick={() => setActiveTab('multiorders')}
                                    icon="üëØ"
                                    label="Multi-Commandes"
                                />
                                <TabButton
                                    active={activeTab === 'ready'}
                                    onClick={() => setActiveTab('ready')}
                                    icon="üéØ"
                                    label="Pr√™t √† exp√©dier"
                                />
                                <TabButton
                                    active={activeTab === 'casiers'}
                                    onClick={() => setActiveTab('casiers')}
                                    icon="üí°"
                                    label="Casiers"
                                />

                            </div>
                        </div>
                    </nav>

                    {/* Contenu */}
                    <main className="container mx-auto px-3 md:px-6 py-4 md:py-8">
                        {lists.length === 0 && activeListId === 'global' ? (
                            <EmptyState onImport={() => setShowImportModal(true)} />
                        ) : (
                            <>
                                {activeTab === 'dashboard' && (
                                    <Dashboard stats={stats} orders={activeOrders} listName={activeListId === 'global' ? 'GLOBAL' : lists.find(l => l.id === activeListId)?.name} openOrderRecap={openGlobalOrderRecap} />
                                )}
                                {activeTab === 'production' && (
                                    <ProductionTab
                                        orders={filteredOrders}
                                        searchTerm={searchTerm}
                                        setSearchTerm={setSearchTerm}
                                        filterStatus={filterStatus}
                                        setFilterStatus={setFilterStatus}
                                        updateStatus={updateStatus}
                                        updateComment={updateComment}
                                        isAdmin={isAdmin}
                                        openOrderRecap={openGlobalOrderRecap}
                                    />
                                )}
                                {activeTab === 'orders' && (
                                    <OrdersTab orders={activeOrders} updateStatus={updateStatus} isAdmin={isAdmin} openOrderRecap={openGlobalOrderRecap} />
                                )}
                                {activeTab === 'multiorders' && (
                                    <MultiOrdersTab orders={activeOrders} openOrderRecap={openGlobalOrderRecap} />
                                )}
                                {activeTab === 'ready' && (
                                    <ReadyToShipTab orders={activeOrders} updateStatus={updateStatus} isAdmin={isAdmin} openOrderRecap={openGlobalOrderRecap} />
                                )}
                                {activeTab === 'casiers' && (
                                    <CasiersTab orders={getAllOrders()} isAdmin={isAdmin} openOrderRecap={openGlobalOrderRecap} />
                                )}


                            </>
                        )}
                    </main>
                </div>
            );
        }

        // Composant TabButton
        function TabButton({ active, onClick, icon, label }) {
            return (
                <button
                    onClick={onClick}
                    className={`px-6 py-3 font-semibold transition border-b-4 ${
                        active
                            ? 'text-green-600 border-green-600 bg-green-50'
                            : 'text-gray-600 border-transparent hover:text-green-600 hover:bg-gray-50'
                    }`}
                >
                    {icon} {label}
                </button>
            );
        }

        // Modal Import
        function ImportModal({ onImport, onClose }) {
            const [listName, setListName] = useState('');
            const [file, setFile] = useState(null);

            const handleSubmit = () => {
                if (!listName.trim()) {
                    alert('Veuillez donner un nom √† la liste');
                    return;
                }
                if (!file) {
                    alert('Veuillez s√©lectionner un fichier');
                    return;
                }
                onImport(listName, file);
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                        <h3 className="text-xl font-bold mb-4">‚ûï Importer une nouvelle liste</h3>
                        
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-semibold mb-2">Nom de la liste</label>
                                <input
                                    type="text"
                                    placeholder="Ex: F√©vrier Semaine 1"
                                    value={listName}
                                    onChange={(e) => setListName(e.target.value)}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
                                />
                            </div>
                            
                            <div>
                                <label className="block text-sm font-semibold mb-2">Fichier CSV</label>
                                <input
                                    type="file"
                                    accept=".csv"
                                    onChange={(e) => setFile(e.target.files[0])}
                                    className="w-full"
                                />
                                <p className="text-xs text-gray-500 mt-1">Format attendu : CSV avec point-virgule (export PrestaShop)</p>
                            </div>
                        </div>

                        <div className="flex gap-3 mt-6">
                            <button
                                onClick={handleSubmit}
                                className="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700"
                            >
                                Importer
                            </button>
                            <button
                                onClick={onClose}
                                className="flex-1 bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300"
                            >
                                Annuler
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Empty State
        function EmptyState({ onImport }) {
            return (
                <div className="text-center py-16">
                    <div className="text-6xl mb-4">üì¶</div>
                    <h2 className="text-2xl font-bold text-gray-800 mb-2">Aucune liste import√©e</h2>
                    <p className="text-gray-600 mb-6">Commencez par importer votre premi√®re liste de commandes</p>
                    <button
                        onClick={onImport}
                        className="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700"
                    >
                        ‚ûï Importer ma premi√®re liste
                    </button>
                </div>
            );
        }

        // Dashboard
        function Dashboard({ stats, orders, listName, openOrderRecap }) {
            const [showTerminesModal, setShowTerminesModal] = useState(false);
            const [showCommentairesModal, setShowCommentairesModal] = useState(false);
            const [showCommandesModal, setShowCommandesModal] = useState(false);
            const terminesOrders = orders.filter(o => o.status === STATUTS.TERMINE || o.status === STATUTS.RANGE);
            // Une commande est "termin√©e" uniquement si TOUS ses articles sont termin√©s
            const terminesRefs = [...new Set(orders.map(o => o.reference))].filter(ref => {
                const articlesCommande = orders.filter(o => o.reference === ref);
                return articlesCommande.every(o => o.status === STATUTS.TERMINE);
            }).sort((a, b) => b - a);



            return (
                <div className="space-y-6">
                    <h2 className="text-2xl font-bold">Dashboard - {listName}</h2>
                    
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <StatCard title="Total Articles" value={stats.total} color="blue" icon="üì¶" />
                        <StatCard title="Commandes" value={[...new Set(orders.map(o => o.reference))].length} color="indigo" icon="üõí" onClick={() => setShowCommandesModal(true)} clickable={true} />
                        <StatCard title="En attente" value={stats.enAttente} color="yellow" icon="‚è≥" />
                        <StatCard title="Termin√©s" value={stats.termines} subtitle={`${orders.filter(o => o.status === STATUTS.TERMINE).length} articles termin√©s`} color="green" icon="‚úÖ" onClick={() => setShowTerminesModal(true)} clickable={true} />
                        <StatCard title="Avec commentaire" value={stats.avecCommentaire} color="purple" icon="üí¨" onClick={() => setShowCommentairesModal(true)} clickable={true} />
                    </div>

                    <div className="bg-white rounded-lg shadow p-6">
                        <h3 className="text-lg font-semibold mb-3">Avancement global</h3>
                        <div className="w-full bg-gray-200 rounded-full h-6">
                            <div
                                className="bg-gradient-to-r from-green-500 to-emerald-500 h-6 rounded-full flex items-center justify-center text-white text-sm font-semibold transition-all"
                                style={{ width: `${stats.total > 0 ? Math.round((stats.termines / stats.total) * 100) : 0}%` }}
                            >
                                {stats.total > 0 ? Math.round((stats.termines / stats.total) * 100) : 0}%
                            </div>
                        </div>
                    </div>

                    {showCommandesModal && (() => {
                        const allRefs = [...new Set(orders.map(o => o.reference))].sort((a,b) => a - b);
                        const byTransporteur = {};
                        allRefs.forEach(ref => {
                            const firstItem = orders.find(o => o.reference === ref);
                            const t = (firstItem && firstItem.transporteur) || 'Non d√©fini';
                            if (!byTransporteur[t]) byTransporteur[t] = [];
                            byTransporteur[t].push(ref);
                        });
                        return (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={() => setShowCommandesModal(false)}>
                                <div className="bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col" onClick={e => e.stopPropagation()}>
                                    <div className="flex justify-between items-center p-6 border-b">
                                        <h3 className="text-xl font-bold text-indigo-700">üõí Toutes les commandes ({allRefs.length})</h3>
                                        <button onClick={() => setShowCommandesModal(false)} className="text-gray-400 hover:text-gray-600 text-2xl">‚úï</button>
                                    </div>
                                    <div className="overflow-y-auto p-6">
                                        <div className="space-y-6">
                                            {Object.entries(byTransporteur).sort((a,b) => a[0].localeCompare(b[0])).map(([transporteur, refs]) => (
                                                <div key={transporteur}>
                                                    <div className="flex items-center justify-between mb-2">
                                                        <h4 className="font-bold text-gray-700">üöö {transporteur}</h4>
                                                        <span className="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded-full">{refs.length} commande(s)</span>
                                                    </div>
                                                    <div className="border border-gray-200 rounded-lg overflow-hidden">
                                                        {refs.map((ref, index) => {
                                                            const items = orders.filter(o => o.reference === ref);
                                                            const termines = items.filter(o => o.status === 'Termin√©').length;
                                                            const total = items.length;
                                                            const pct = total > 0 ? Math.round(termines/total*100) : 0;
                                                            return (
                                                                <div key={ref} className={`py-2 px-3 flex items-center justify-between gap-3 ${index % 2 === 0 ? 'bg-indigo-50' : 'bg-white'}`}>
                                                                    <button onClick={() => { setShowCommandesModal(false); openOrderRecap(ref); }} className="font-mono text-indigo-800 font-semibold hover:text-blue-600 hover:underline">
                                                                        #{ref}
                                                                    </button>
                                                                    <div className="flex items-center gap-2 flex-1 justify-end">
                                                                        <div className="w-20 bg-gray-200 rounded-full h-1.5">
                                                                            <div className={`h-1.5 rounded-full ${pct === 100 ? 'bg-green-500' : 'bg-blue-400'}`} style={{width: `${pct}%`}}></div>
                                                                        </div>
                                                                        <span className="text-xs text-gray-500 whitespace-nowrap">{termines}/{total}</span>
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="p-4 border-t bg-gray-50 rounded-b-xl">
                                        <p className="text-sm text-gray-500 text-center">{allRefs.length} commandes ‚Ä¢ {orders.length} articles au total</p>
                                    </div>
                                </div>
                            </div>
                        );
                    })()}

                    {showTerminesModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col">
                                <div className="flex justify-between items-center p-6 border-b">
                                    <h3 className="text-xl font-bold text-green-700">‚úÖ Commandes termin√©es ({terminesRefs.length})</h3>
                                    <button onClick={() => setShowTerminesModal(false)} className="text-gray-400 hover:text-gray-600 text-2xl">‚úï</button>
                                </div>
                                <div className="overflow-y-auto p-6">
                                    {terminesRefs.length === 0 ? (
                                        <p className="text-gray-500 text-center py-8">Aucune commande termin√©e pour l'instant</p>
                                    ) : (
                                        <div className="space-y-6">
                                            {(() => {
                                                const byTransporteur = {};
                                                // Utiliser uniquement les commandes 100% termin√©es
                                                terminesRefs.forEach(ref => {
                                                    const firstItem = orders.find(o => o.reference === ref);
                                                    const t = (firstItem && firstItem.transporteur) || 'Non d√©fini';
                                                    if (!byTransporteur[t]) byTransporteur[t] = new Set();
                                                    byTransporteur[t].add(ref);
                                                });
                                                return Object.entries(byTransporteur).sort((a,b) => a[0].localeCompare(b[0])).map(([transporteur, refs]) => {
                                                    const refsArray = [...refs].sort((a,b) => b - a);
                                                    return (
                                                        <div key={transporteur}>
                                                            <div className="flex items-center justify-between mb-2">
                                                                <h4 className="font-bold text-gray-700">üöö {transporteur}</h4>
                                                                <span className="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded-full">{refsArray.length} commande(s)</span>
                                                            </div>
                                                            <div className="border border-gray-200 rounded-lg overflow-hidden">
                                                                {refsArray.map((ref, index) => (
                                                                    <div key={ref} className={`py-2 px-3 ${index % 2 === 0 ? 'bg-green-50' : 'bg-white'}`}>
                                                                        <button
                                                                            onClick={(e) => { e.stopPropagation(); openOrderRecap(ref); }}
                                                                            className="font-mono text-green-900 text-base hover:text-blue-600 hover:underline cursor-pointer text-left w-full flex items-center gap-2"
                                                                        >
                                                                            {ref}
                                                                        </button>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    );
                                                });
                                            })()}
                                        </div>
                                    )}
                                </div>
                                <div className="p-4 border-t bg-gray-50 rounded-b-xl">
                                    <p className="text-sm text-gray-500 text-center">{terminesOrders.length} article(s) termin√©(s) au total</p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal Avec Commentaires */}
                    {showCommentairesModal && (() => {
                        const commandesAvecCommentaire = {};
                        orders.forEach(o => {
                            if (o.commentaires && o.commentaires.trim()) {
                                if (!commandesAvecCommentaire[o.reference]) commandesAvecCommentaire[o.reference] = [];
                                commandesAvecCommentaire[o.reference].push(o);
                            }
                        });
                        const refs = Object.keys(commandesAvecCommentaire).sort((a,b) => b - a);
                        return (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col">
                                    <div className="flex justify-between items-center p-6 border-b">
                                        <h3 className="text-xl font-bold text-purple-700">üí¨ Commandes avec commentaire ({refs.length})</h3>
                                        <button onClick={() => setShowCommentairesModal(false)} className="text-gray-400 hover:text-gray-600 text-2xl">‚úï</button>
                                    </div>
                                    <div className="overflow-y-auto p-6">
                                        {refs.length === 0 ? (
                                            <p className="text-gray-500 text-center py-8">Aucun commentaire pour l'instant</p>
                                        ) : (
                                            <div className="space-y-3">
                                                {refs.map(ref => (
                                                    <div key={ref} className="border border-purple-100 rounded-lg overflow-hidden">
                                                        <div className="bg-purple-50 px-4 py-2 flex items-center justify-between">
                                                            <button
                                                                onClick={() => { setShowCommentairesModal(false); openOrderRecap(ref); }}
                                                                className="font-mono font-bold text-purple-800 hover:text-blue-600 hover:underline"
                                                            >
                                                                #{ref}
                                                            </button>
                                                            <span className="text-xs text-purple-500">{commandesAvecCommentaire[ref][0].client}</span>
                                                        </div>
                                                        {commandesAvecCommentaire[ref].map((o, i) => (
                                                            <div key={i} className="px-4 py-2 border-t border-purple-50">
                                                                <p className="text-sm text-gray-700 truncate">{o.name}</p>
                                                                <p className="text-sm italic text-purple-600 mt-0.5">üí¨ {o.commentaires}</p>
                                                            </div>
                                                        ))}
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                    <div className="p-4 border-t bg-gray-50 rounded-b-xl">
                                        <p className="text-sm text-gray-500 text-center">{refs.length} commande(s) avec commentaire</p>
                                    </div>
                                </div>
                            </div>
                        );
                    })()}

                    {/* Modal R√©capitulatif Commande */}

                </div>
            );
        }

        // StatCard
        function StatCard({ title, value, subtitle, color, icon, onClick, clickable }) {
            const colors = {
                blue: 'bg-blue-50 border-blue-200 text-blue-700',
                yellow: 'bg-yellow-50 border-yellow-200 text-yellow-700',
                green: 'bg-green-50 border-green-200 text-green-700',
                purple: 'bg-purple-50 border-purple-200 text-purple-700'
            };
            return (
                <div className={`rounded-lg border-2 p-6 ${colors[color]} ${clickable ? 'cursor-pointer hover:shadow-md hover:scale-105 transition-transform' : ''}`}
                    onClick={clickable ? onClick : undefined}>
                    <div className="flex justify-between items-start">
                        <div>
                            <p className="text-sm font-medium opacity-75">{title}</p>
                            <p className="text-3xl font-bold mt-1">{value}</p>
                            {subtitle && <p className="text-xs opacity-60 mt-0.5">{subtitle}</p>}
                            {clickable && <p className="text-xs opacity-60 mt-1">Cliquer pour voir ‚Ä∫</p>}
                        </div>
                        <div className="text-4xl opacity-50">{icon}</div>
                    </div>
                </div>
            );
        }

        // ProductionTab
        function ProductionTab({ orders, searchTerm, setSearchTerm, filterStatus, setFilterStatus, updateStatus, isAdmin, openOrderRecap }) {
            const [selectedImage, setSelectedImage] = React.useState(null);
            const [sortColumn, setSortColumn] = React.useState('name'); // Colonne de tri par d√©faut
            const [sortDirection, setSortDirection] = React.useState('asc'); // asc ou desc
            
            // Fonction de tri
            const handleSort = (column) => {
                if (sortColumn === column) {
                    // Inverse la direction si on clique sur la m√™me colonne
                    setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');
                } else {
                    // Nouvelle colonne, tri ascendant par d√©faut
                    setSortColumn(column);
                    setSortDirection('asc');
                }
            };
            
            // Trier les commandes
            const sortedOrders = [...orders].sort((a, b) => {
                let aVal = a[sortColumn] || '';
                let bVal = b[sortColumn] || '';
                
                // Tri num√©rique pour reference
                if (sortColumn === 'reference') {
                    aVal = parseInt(aVal) || 0;
                    bVal = parseInt(bVal) || 0;
                } else {
                    // Tri alphab√©tique pour les autres
                    aVal = String(aVal).toLowerCase();
                    bVal = String(bVal).toLowerCase();
                }
                
                if (sortDirection === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            // Fonction pour ouvrir le r√©cap d'une commande

            
            return (
                <div className="space-y-6">
                    {/* Modal Image en grand */}
                    {selectedImage && (
                        <div 
                            className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[80] p-4"
                            onClick={() => setSelectedImage(null)}
                        >
                            <div className="max-w-4xl max-h-[90vh] relative">
                                <button
                                    onClick={() => setSelectedImage(null)}
                                    className="absolute -top-10 right-0 text-white text-2xl hover:text-gray-300"
                                >
                                    ‚úï Fermer
                                </button>
                                <img 
                                    src={selectedImage.url}
                                    alt={selectedImage.name}
                                    className="max-w-full max-h-[90vh] object-contain rounded shadow-2xl"
                                    onClick={(e) => e.stopPropagation()}
                                />
                                <p className="text-white text-center mt-4 text-lg">{selectedImage.name}</p>
                            </div>
                        </div>
                    )}
                    
                    {/* Modal R√©capitulatif Commande */}

                    
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="grid grid-cols-1 gap-3 md:grid-cols-3 md:gap-4">
                            <div>
                                <label className="block text-sm font-semibold mb-2">üîç Rechercher</label>
                                <input
                                    type="text"
                                    placeholder="Produit ou n¬∞ commande..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-semibold mb-2">üìä Statut</label>
                                <select
                                    value={filterStatus}
                                    onChange={(e) => setFilterStatus(e.target.value)}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                >
                                    <option value="all">Tous</option>
                                    {Object.values(STATUTS).map(s => (
                                        <option key={s} value={s}>{s}</option>
                                    ))}
                                </select>
                            </div>
                            <div className="flex items-end">
                                <button
                                    onClick={() => { setSearchTerm(''); setFilterStatus('all'); }}
                                    className="w-full px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300"
                                >
                                    üîÑ Effacer
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* TRI MOBILE */}
                    <div className="md:hidden bg-white rounded-lg shadow p-3 flex gap-2 items-center">
                        <span className="text-sm font-semibold text-gray-600 whitespace-nowrap">Trier par :</span>
                        <select
                            value={sortColumn}
                            onChange={(e) => setSortColumn(e.target.value)}
                            className="flex-1 px-2 py-1 border border-gray-300 rounded text-sm"
                        >
                            <option value="reference">N¬∞ Commande</option>
                            <option value="name">Produit</option>
                            <option value="client">Client</option>
                            <option value="transporteur">Transporteur</option>
                            <option value="status">Statut</option>
                        </select>
                        <button
                            onClick={() => setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc')}
                            className="px-3 py-1 bg-gray-100 rounded border text-sm font-semibold"
                        >
                            {sortDirection === 'asc' ? '‚Üë' : '‚Üì'}
                        </button>
                    </div>

                    {/* VUE MOBILE : cartes */}
                    <div className="md:hidden space-y-3">
                        {sortedOrders.map(order => (
                            <div key={order.id} className={`rounded-xl shadow p-4 border transition-colors ${
                                order.status === STATUTS.TERMINE ? 'bg-green-50 border-green-200' :
                                order.status === STATUTS.AVEC_COMMENTAIRE ? 'bg-orange-50 border-orange-200' :
                                'bg-white border-gray-200'
                            }`}>
                                <div className="flex gap-3">
                                    {order.url_image ? (
                                        <img src={order.url_image} alt={order.name}
                                            className="w-20 h-20 object-cover rounded-lg border flex-shrink-0 cursor-pointer"
                                            onClick={() => setSelectedImage({ url: order.url_image, name: order.name })}
                                            onError={(e) => e.target.style.display = 'none'} />
                                    ) : (
                                        <div className="w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400 text-xs flex-shrink-0">Pas d'image</div>
                                    )}
                                    <div className="flex-1 min-w-0">
                                        <div className="flex justify-between items-start gap-2">
                                            <span className="font-bold text-blue-600 cursor-pointer text-sm" onClick={() => openOrderRecap(order.reference)}>#{order.reference}</span>
                                            <select
                                                value={order.status}
                                                onChange={(e) => isAdmin && updateStatus(order.id, e.target.value, order.commentaires)}
                                                disabled={!isAdmin}
                                                className={`text-xs px-2 py-1 border rounded flex-shrink-0 ${!isAdmin ? 'bg-gray-100 text-gray-400' : ''}`}
                                            >
                                                {Object.values(STATUTS).map(s => (<option key={s} value={s}>{s}</option>))}
                                            </select>
                                        </div>
                                        <p className="text-sm font-medium text-gray-800 mt-1 truncate">{order.name}</p>
                                        <p className="text-xs text-gray-500 mt-0.5">{order.client || ''}</p>
                                        <p className="text-xs text-gray-500">üöö {order.transporteur || '-'}</p>
                                    </div>
                                </div>
                                {order.commentaires ? (
                                    <div className="mt-3 flex items-center gap-2">
                                        <p className="flex-1 text-sm italic text-purple-700 bg-purple-50 border border-purple-200 rounded-lg px-3 py-2">üí¨ {order.commentaires}</p>
                                        {isAdmin && <button onClick={() => updateStatus(order.id, order.status, '')} className="text-xs text-red-400 hover:text-red-600">‚úï</button>}
                                    </div>
                                ) : isAdmin ? (
                                    <input
                                        type="text"
                                        defaultValue=""
                                        onBlur={(e) => e.target.value && updateStatus(order.id, order.status, e.target.value)}
                                        onKeyDown={(e) => e.key === 'Enter' && e.target.value && updateStatus(order.id, order.status, e.target.value)}
                                        placeholder="üí¨ Ajouter une note..."
                                        className="mt-3 w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500"
                                    />
                                ) : null}
                            </div>
                        ))}
                    </div>

                    {/* VUE DESKTOP : tableau */}
                    <div className="hidden md:block bg-white rounded-lg shadow overflow-x-auto">
                        <table className="w-full">
                            <thead className="bg-gray-50 border-b">
                                <tr>
                                    <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Photo</th>
                                    <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase cursor-pointer hover:bg-gray-100" onClick={() => handleSort('reference')}>
                                        N¬∞ Commande {sortColumn === 'reference' && (sortDirection === 'asc' ? '‚Üë' : '‚Üì')}
                                    </th>
                                    <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase cursor-pointer hover:bg-gray-100" onClick={() => handleSort('name')}>
                                        Produit {sortColumn === 'name' && (sortDirection === 'asc' ? '‚Üë' : '‚Üì')}
                                    </th>
                                    <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase cursor-pointer hover:bg-gray-100" onClick={() => handleSort('client')}>
                                        Client {sortColumn === 'client' && (sortDirection === 'asc' ? '‚Üë' : '‚Üì')}
                                    </th>
                                    <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase cursor-pointer hover:bg-gray-100" onClick={() => handleSort('transporteur')}>
                                        Transporteur {sortColumn === 'transporteur' && (sortDirection === 'asc' ? '‚Üë' : '‚Üì')}
                                    </th>
                                    <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Commentaires</th>
                                    <th className="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase cursor-pointer hover:bg-gray-100" onClick={() => handleSort('status')}>
                                        Statut {sortColumn === 'status' && (sortDirection === 'asc' ? '‚Üë' : '‚Üì')}
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {sortedOrders.map(order => (
                                    <tr key={order.id} className={`border-b transition-colors ${
                                        order.status === STATUTS.TERMINE ? 'bg-green-50 hover:bg-green-100' :
                                        order.status === STATUTS.AVEC_COMMENTAIRE ? 'bg-orange-50 hover:bg-orange-100' :
                                        'bg-white hover:bg-gray-50'
                                    }`}>
                                        <td className="px-4 py-3">
                                            {order.url_image ? (
                                                <img src={order.url_image} alt={order.name}
                                                    className="w-16 h-16 object-cover rounded border cursor-pointer hover:opacity-80 transition"
                                                    onClick={() => setSelectedImage({ url: order.url_image, name: order.name })}
                                                    onError={(e) => e.target.style.display = 'none'} />
                                            ) : (
                                                <div className="w-16 h-16 bg-gray-100 rounded flex items-center justify-center text-gray-400 text-xs">Pas d'image</div>
                                            )}
                                        </td>
                                        <td className="px-4 py-3">
                                            <span className="font-semibold text-blue-600 cursor-pointer hover:text-blue-800 hover:underline" onClick={() => openOrderRecap(order.reference)}>#{order.reference}</span>
                                        </td>
                                        <td className="px-4 py-3">{order.name}</td>
                                        <td className="px-4 py-3 text-sm">{order.client || '-'}</td>
                                        <td className="px-4 py-3 text-sm">{order.transporteur || '-'}</td>
                                        <td className="px-4 py-3">
                                            {order.commentaires ? (
                                                <div className="flex items-center gap-1">
                                                    <p className="text-sm italic text-purple-700">üí¨ {order.commentaires}</p>
                                                    {isAdmin && <button onClick={() => updateStatus(order.id, order.status, '')} className="text-xs text-red-400 hover:text-red-600 ml-1">‚úï</button>}
                                                </div>
                                            ) : isAdmin ? (
                                                <input type="text" defaultValue=""
                                                    onBlur={(e) => e.target.value && updateStatus(order.id, order.status, e.target.value)}
                                                    onKeyDown={(e) => e.key === 'Enter' && e.target.value && updateStatus(order.id, order.status, e.target.value)}
                                                    placeholder="Ajouter une note..."
                                                    className="w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent" />
                                            ) : (
                                                <span className="text-gray-300 text-xs">‚Äî</span>
                                            )}
                                        </td>
                                        <td className="px-4 py-3 text-center">
                                            <select value={order.status}
                                                onChange={(e) => isAdmin && updateStatus(order.id, e.target.value, order.commentaires)}
                                                disabled={!isAdmin}
                                                className={`px-3 py-1 border rounded text-sm ${!isAdmin ? 'bg-gray-100 cursor-not-allowed text-gray-400' : ''}`}>
                                                {Object.values(STATUTS).map(s => (<option key={s} value={s}>{s}</option>))}
                                            </select>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        // OrdersTab
        function OrdersTab({ orders, updateStatus, isAdmin, openOrderRecap }) {
            const [selectedOrder, setSelectedOrder] = useState('');
            const [searchOrder, setSearchOrder] = useState('');
            const [selectedImage, setSelectedImage] = React.useState(null);
            
            const orderGroups = {};
            orders.forEach(order => {
                if (!orderGroups[order.reference]) {
                    orderGroups[order.reference] = [];
                }
                orderGroups[order.reference].push(order);
            });

            const orderNumbers = Object.keys(orderGroups).sort((a, b) => b - a);
            const filteredOrderNumbers = searchOrder 
                ? orderNumbers.filter(num => num.includes(searchOrder))
                : orderNumbers;

            return (
                <div className="space-y-6">
                    {/* Modal Image en grand */}
                    {selectedImage && (
                        <div 
                            className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[80] p-4"
                            onClick={() => setSelectedImage(null)}
                        >
                            <div className="max-w-4xl max-h-[90vh] relative">
                                <button
                                    onClick={() => setSelectedImage(null)}
                                    className="absolute -top-10 right-0 text-white text-2xl hover:text-gray-300"
                                >
                                    ‚úï Fermer
                                </button>
                                <img 
                                    src={selectedImage.url}
                                    alt={selectedImage.name}
                                    className="max-w-full max-h-[90vh] object-contain rounded shadow-2xl"
                                    onClick={(e) => e.stopPropagation()}
                                />
                                <p className="text-white text-center mt-4 text-lg">{selectedImage.name}</p>
                            </div>
                        </div>
                    )}
                    
                    <div className="bg-white rounded-lg shadow p-6">
                        <label className="block text-sm font-semibold mb-2">üîç Rechercher une commande</label>
                        <input
                            type="text"
                            placeholder="Tapez un num√©ro..."
                            value={searchOrder}
                            onChange={(e) => {
                                setSearchOrder(e.target.value);
                                const matches = orderNumbers.filter(num => num.includes(e.target.value));
                                if (matches.length === 1) setSelectedOrder(matches[0]);
                            }}
                            className="w-full px-4 py-2 border rounded-lg mb-4"
                        />
                        
                        <label className="block text-sm font-semibold mb-2">üìã Ou s√©lectionner</label>
                        <select
                            value={selectedOrder}
                            onChange={(e) => setSelectedOrder(e.target.value)}
                            className="w-full px-4 py-2 border rounded-lg"
                        >
                            <option value="">-- Choisir --</option>
                            {filteredOrderNumbers.map(num => (
                                <option key={num} value={num}>
                                    Commande #{num} ({orderGroups[num].length} articles)
                                </option>
                            ))}
                        </select>
                    </div>

                    {selectedOrder && (
                        <div className="bg-white rounded-lg shadow p-6">
                            <h3 className="text-xl font-bold mb-4 flex items-center gap-3">
                                <span>Commande #{selectedOrder} - {orderGroups[selectedOrder].length} article(s)</span>
                                <button
                                    onClick={() => openOrderRecap(selectedOrder)}
                                    className="text-sm font-semibold px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition"
                                >
                                    üìã Voir la fiche
                                </button>
                            </h3>
                            <div className="space-y-3">
                                {orderGroups[selectedOrder].map(order => (
                                    <div key={order.id} className="border rounded-lg p-4">
                                        <div className="flex justify-between items-start gap-4">
                                            {/* Photo */}
                                            {order.url_image && (
                                                <div className="flex-shrink-0">
                                                    <img 
                                                        src={order.url_image} 
                                                        alt={order.name}
                                                        className="w-20 h-20 object-cover rounded border cursor-pointer hover:opacity-80 transition"
                                                        onClick={() => setSelectedImage({ url: order.url_image, name: order.name })}
                                                        onError={(e) => e.target.style.display = 'none'}
                                                    />
                                                </div>
                                            )}
                                            
                                            <div className="flex-1">
                                                <h4 className="font-semibold text-lg">{order.name}</h4>
                                                
                                                {/* Infos client et transporteur */}
                                                <div className="mt-2 flex gap-4 text-sm text-gray-600">
                                                    {order.client && <span>üë§ {order.client}</span>}
                                                    {order.transporteur && <span>üöö {order.transporteur}</span>}
                                                    {order.quantity && <span>üì¶ Qt√©: {order.quantity}</span>}
                                                </div>
                                                
                                                {/* Commentaire */}
                                                <div className="mt-3">
                                                    {order.commentaires ? (
                                                        <p className="text-sm italic text-purple-700 bg-purple-50 border border-purple-200 rounded px-3 py-2">üí¨ {order.commentaires}</p>
                                                    ) : (
                                                        <input
                                                            type="text"
                                                            value=""
                                                            onChange={(e) => updateStatus(order.id, order.status, e.target.value)}
                                                            placeholder="üí¨ Ajouter une note..."
                                                            className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 text-sm"
                                                        />
                                                    )}
                                                </div>
                                            </div>
                                            
                                            {/* Statut */}
                                            <select
                                                value={order.status}
                                                onChange={(e) => updateStatus(order.id, e.target.value, order.commentaires)}
                                                className="px-3 py-2 border rounded text-sm flex-shrink-0"
                                            >
                                                {Object.values(STATUTS).map(s => (
                                                    <option key={s} value={s}>{s}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        }




        // MultiOrdersTab - Clientes avec plusieurs commandes
        function MultiOrdersTab({ orders }) {
            const [selectedClient, setSelectedClient] = React.useState(null);

            const clientMap = {};
            orders.forEach(o => {
                const key = (o.client || 'Inconnu') + '||' + (o.email || '');
                if (!clientMap[key]) {
                    clientMap[key] = { nom: o.client || 'Inconnu', email: o.email || '', commandes: new Set(), articles: [] };
                }
                clientMap[key].commandes.add(o.reference);
                clientMap[key].articles.push(o);
            });

            const multiClients = Object.values(clientMap)
                .filter(c => c.commandes.size >= 2)
                .map(c => ({ ...c, commandes: [...c.commandes].sort((a,b) => b - a) }))
                .sort((a, b) => b.commandes.length - a.commandes.length);

            if (multiClients.length === 0) {
                return (
                    <div className="text-center py-16 text-gray-400">
                        <div className="text-5xl mb-4">üéâ</div>
                        <p className="text-lg font-semibold">Aucune cliente avec plusieurs commandes</p>
                    </div>
                );
            }

            return (
                <div className="space-y-4">
                    {selectedClient && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4" onClick={() => setSelectedClient(null)}>
                            <div className="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                <div className="sticky top-0 bg-gradient-to-r from-purple-600 to-purple-700 text-white p-6 rounded-t-xl">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <h3 className="text-xl font-bold">üë§ {selectedClient.nom}</h3>
                                            {selectedClient.email && <p className="text-purple-200 text-sm mt-1">‚úâÔ∏è {selectedClient.email}</p>}
                                            <p className="text-purple-200 text-sm mt-1">üì¶ {selectedClient.commandes.length} commandes ‚Äî {selectedClient.articles.length} articles</p>
                                        </div>
                                        <button onClick={() => setSelectedClient(null)} className="text-white text-2xl">‚úï</button>
                                    </div>
                                </div>
                                <div className="p-6 space-y-4">
                                    {selectedClient.commandes.map(ref => {
                                        const items = selectedClient.articles.filter(a => a.reference === ref);
                                        const allDone = items.every(i => i.status === 'Termin√©');
                                        return (
                                            <div key={ref} className={`border rounded-lg overflow-hidden ${allDone ? 'border-green-300 bg-green-50' : 'border-gray-200'}`}>
                                                <div className="flex items-center justify-between px-4 py-3 bg-gray-50 border-b">
                                                    <span className="font-bold text-gray-800">Commande #{ref}</span>
                                                    {allDone ? <span className="text-xs bg-green-200 text-green-800 px-2 py-1 rounded-full">‚úÖ Termin√©e</span> : <span className="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">‚è≥ En cours</span>}
                                                </div>
                                                {items.map((item, i) => (
                                                    <div key={i} className="flex items-center gap-3 px-4 py-3 border-b last:border-0">
                                                        {item.image && <img src={item.image} className="w-12 h-12 object-cover rounded" />}
                                                        <div className="flex-1 min-w-0">
                                                            <p className="text-sm font-medium text-gray-800 truncate">{item.name}</p>
                                                            {item.transporteur && <p className="text-xs text-gray-500">üöö {item.transporteur}</p>}
                                                        </div>
                                                        <span className={`text-xs px-2 py-1 rounded-full ${item.status === 'Rang√©' ? 'bg-purple-100 text-purple-700' : item.status === 'Termin√©' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`}>{item.status}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="flex items-center justify-between">
                        <h2 className="text-xl font-bold text-gray-800">üëØ Clientes multi-commandes</h2>
                        <span className="bg-purple-100 text-purple-700 text-sm font-semibold px-3 py-1 rounded-full">{multiClients.length} cliente(s)</span>
                    </div>
                    <p className="text-sm text-gray-500">Ces clientes ont pass√© plusieurs commandes ‚Äî pensez √† regrouper l'envoi !</p>

                    <div className="space-y-3">
                        {multiClients.map((client, i) => {
                            const totalArticles = client.articles.length;
                            const termines = client.articles.filter(a => a.status === 'Termin√©').length;
                            const allDone = termines === totalArticles;
                            const transporteurs = [...new Set(client.articles.map(a => a.transporteur).filter(Boolean))];
                            return (
                                <div key={i} className="bg-white rounded-xl shadow-sm border border-gray-200 p-4 cursor-pointer hover:shadow-md hover:border-purple-300 transition-all" onClick={() => setSelectedClient(client)}>
                                    <div className="flex items-center justify-between gap-3">
                                        <div className="flex-1 min-w-0">
                                            <div className="flex items-center gap-2">
                                                <span className="font-semibold text-gray-800">{client.nom}</span>
                                                {allDone && <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full">Tout termin√©</span>}
                                            </div>
                                            {client.email && <p className="text-xs text-gray-400 mt-0.5 truncate">‚úâÔ∏è {client.email}</p>}
                                            {transporteurs.length > 0 && <p className="text-xs text-gray-400 mt-0.5">üöö {transporteurs.join(', ')}</p>}
                                        </div>
                                        <div className="flex flex-col items-end gap-1 flex-shrink-0">
                                            <span className="bg-purple-100 text-purple-700 text-sm font-bold px-3 py-1 rounded-full">{client.commandes.length} commandes</span>
                                            <span className="text-xs text-gray-400">{termines}/{totalArticles} articles termin√©s</span>
                                        </div>
                                    </div>
                                    <div className="mt-3 flex flex-wrap gap-2">
                                        {client.commandes.map(ref => (
                                            <span key={ref} className="font-mono text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">#{ref}</span>
                                        ))}
                                    </div>
                                    <div className="mt-2 w-full bg-gray-100 rounded-full h-1.5">
                                        <div className="bg-green-500 h-1.5 rounded-full transition-all" style={{width: `${totalArticles > 0 ? (termines/totalArticles)*100 : 0}%`}}></div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }

        // ReadyToShipTab - Commandes pr√™tes √† exp√©dier d√®s r√©ception d'un article
        function ReadyToShipTab({ orders, updateStatus, isAdmin }) {
            const [search, setSearch] = React.useState('');
            const [selectedOrder, setSelectedOrder] = React.useState(null);

            // Trouver les commandes o√π l'article recherch√© est le SEUL en attente
            const results = React.useMemo(() => {
                if (!search.trim()) return [];
                const query = search.toLowerCase().trim();
                
                // Grouper par r√©f√©rence
                const byRef = {};
                orders.forEach(o => {
                    if (!byRef[o.reference]) byRef[o.reference] = [];
                    byRef[o.reference].push(o);
                });

                const matches = [];
                Object.entries(byRef).forEach(([ref, items]) => {
                    // Articles en attente qui correspondent √† la recherche
                    const enAttente = items.filter(o => o.status !== 'Termin√©');
                    const matchingEnAttente = enAttente.filter(o => o.name.toLowerCase().includes(query));
                    
                    // La commande est "pr√™te" si :
                    // - il y a exactement 1 article en attente ET il correspond √† la recherche
                    if (enAttente.length === 1 && matchingEnAttente.length === 1) {
                        const termines = items.filter(o => o.status === 'Termin√©');
                        matches.push({
                            reference: ref,
                            client: items[0].client,
                            email: items[0].email,
                            transporteur: items[0].transporteur,
                            adresse_livraison: items[0].adresse_livraison,
                            telephone: items[0].telephone,
                            articleManquant: matchingEnAttente[0],
                            articlesTermines: termines,
                            totalArticles: items.length
                        });
                    }
                });

                return matches.sort((a, b) => b.reference - a.reference);
            }, [search, orders]);

            const terminerArticle = (article) => {
                updateStatus(article.id, 'Termin√©', article.commentaires);
            };

            return (
                <div className="space-y-4">
                    {/* Modal d√©tail commande */}
                    {selectedOrder && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4" onClick={() => setSelectedOrder(null)}>
                            <div className="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                <div className="sticky top-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-xl">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <h3 className="text-xl font-bold">üì¶ Commande #{selectedOrder.reference}</h3>
                                            <p className="text-blue-200 text-sm mt-1">üë§ {selectedOrder.client}</p>
                                            {selectedOrder.transporteur && <p className="text-blue-200 text-sm">üöö {selectedOrder.transporteur}</p>}
                                        </div>
                                        <button onClick={() => setSelectedOrder(null)} className="text-white text-2xl">‚úï</button>
                                    </div>
                                </div>
                                <div className="p-6 space-y-3">
                                    {/* Article manquant en premier */}
                                    <div className="border-2 border-orange-300 bg-orange-50 rounded-lg p-4">
                                        <p className="text-xs font-bold text-orange-600 mb-2">‚è≥ ARTICLE EN ATTENTE</p>
                                        <div className="flex items-center gap-3">
                                            {selectedOrder.articleManquant.url_image && <img src={selectedOrder.articleManquant.url_image} className="w-16 h-16 object-cover rounded" onError={e => e.target.style.display='none'} />}
                                            <div className="flex-1">
                                                <p className="font-semibold text-gray-800">{selectedOrder.articleManquant.name}</p>
                                            </div>
                                            {isAdmin && (
                                                <button
                                                    onClick={() => { terminerArticle(selectedOrder.articleManquant); setSelectedOrder(null); }}
                                                    className="px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-bold rounded-lg transition"
                                                >
                                                    ‚úÖ Terminer
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                    {/* Articles d√©j√† termin√©s */}
                                    {selectedOrder.articlesTermines.map((item, i) => (
                                        <div key={i} className="flex items-center gap-3 border border-green-200 bg-green-50 rounded-lg p-3">
                                            {item.url_image && <img src={item.url_image} className="w-12 h-12 object-cover rounded" onError={e => e.target.style.display='none'} />}
                                            <p className="flex-1 text-sm text-gray-700">{item.name}</p>
                                            <span className="text-xs bg-green-200 text-green-800 px-2 py-1 rounded-full">‚úÖ Termin√©</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    <div>
                        <h2 className="text-xl font-bold text-gray-800 mb-1">üéØ Pr√™t √† exp√©dier</h2>
                        <p className="text-sm text-gray-500 mb-4">Tapez le nom d'un article re√ßu pour voir les commandes qu'il permet de cl√¥turer</p>
                    </div>

                    {/* Barre de recherche */}
                    <div className="relative">
                        <input
                            type="text"
                            value={search}
                            onChange={e => setSearch(e.target.value)}
                            placeholder="üîç Ex: Abaya Sineme, Robe Ella..."
                            className="w-full px-5 py-4 text-lg border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 shadow-sm"
                            autoFocus
                        />
                        {search && <button onClick={() => setSearch('')} className="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 text-xl">‚úï</button>}
                    </div>

                    {/* R√©sultats */}
                    {search.trim() && (
                        <div>
                            {results.length === 0 ? (
                                <div className="text-center py-12 text-gray-400">
                                    <div className="text-4xl mb-3">üîç</div>
                                    <p className="font-semibold">Aucune commande pr√™te √† cl√¥turer</p>
                                    <p className="text-sm mt-1">Soit l'article n'existe pas, soit d'autres articles sont encore en attente</p>
                                </div>
                            ) : (
                                <div className="space-y-3">
                                    <p className="text-sm font-semibold text-green-700">üéâ {results.length} commande(s) peuvent √™tre cl√¥tur√©es !</p>
                                    {results.map(order => (
                                        <div key={order.reference}
                                            className="bg-white rounded-xl border-2 border-orange-200 shadow-sm p-4 cursor-pointer hover:shadow-md hover:border-orange-400 transition-all"
                                            onClick={() => setSelectedOrder(order)}
                                        >
                                            <div className="flex items-center justify-between gap-3">
                                                <div className="flex-1 min-w-0">
                                                    <div className="flex items-center gap-2">
                                                        <span className="font-mono font-bold text-gray-800">#{order.reference}</span>
                                                        <span className="text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full">1 article manquant</span>
                                                    </div>
                                                    <p className="text-sm text-gray-600 mt-0.5">üë§ {order.client}</p>
                                                    {order.transporteur && <p className="text-xs text-gray-400">üöö {order.transporteur}</p>}
                                                </div>
                                                <div className="flex flex-col items-end gap-1">
                                                    <span className="text-xs text-gray-400">{order.totalArticles} article(s) au total</span>
                                                    <span className="text-xs text-green-600 font-semibold">{order.articlesTermines.length} termin√©(s)</span>
                                                </div>
                                            </div>
                                            <div className="mt-3 pt-3 border-t border-orange-100">
                                                <p className="text-xs text-orange-600 font-semibold mb-1">‚è≥ Il manque :</p>
                                                <p className="text-sm text-gray-700">{order.articleManquant.name}</p>
                                            </div>
                                            {isAdmin && (
                                                <button
                                                    onClick={e => { e.stopPropagation(); terminerArticle(order.articleManquant); }}
                                                    className="mt-3 w-full py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-bold rounded-lg transition"
                                                >
                                                    ‚úÖ Terminer cet article et cl√¥turer la commande
                                                </button>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}

                    {!search.trim() && (
                        <div className="text-center py-16 text-gray-300">
                            <div className="text-6xl mb-4">üéØ</div>
                            <p className="text-lg font-semibold text-gray-400">Tapez un nom d'article</p>
                            <p className="text-sm text-gray-300 mt-1">pour trouver les commandes pr√™tes √† partir</p>
                        </div>
                    )}
                </div>
            );
        }



        // Page de connexion
        function LoginPage() {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleLogin = async () => {
                if (!email || !password) { setError('Veuillez remplir tous les champs'); return; }
                setLoading(true); setError('');
                try {
                    await window.firebaseSignIn(email, password);
                } catch (e) {
                    setError('Email ou mot de passe incorrect');
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
                        <div className="text-center mb-8">
                            <div className="text-6xl mb-4">üì¶</div>
                            <h1 className="text-2xl font-bold text-gray-800">Gestion Production</h1>
                            <p className="text-gray-500 text-sm mt-1">Sousou Fashion</p>
                        </div>
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-semibold text-gray-700 mb-1">Email</label>
                                <input
                                    type="email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    onKeyDown={(e) => e.key === 'Enter' && handleLogin()}
                                    placeholder="votre@email.com"
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-gray-700 mb-1">Mot de passe</label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    onKeyDown={(e) => e.key === 'Enter' && handleLogin()}
                                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                />
                            </div>
                            {error && <p className="text-red-500 text-sm bg-red-50 px-3 py-2 rounded-lg">{error}</p>}
                            <button
                                onClick={handleLogin}
                                disabled={loading}
                                className="w-full py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition disabled:opacity-50"
                            >
                                {loading ? 'Connexion...' : 'Se connecter'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // CasiersTab
        function CasiersTab({ orders, isAdmin, openOrderRecap }) {
            const CONFIG = {
                colonneGauche: { etageres: 4, etages: 4, casiersParEtage: 6 },
                rangeesMilieu: { nb: 3, etageresParRangee: 8, etages: 4, casiersParEtage: 6 },
                bas: { etageres: 4, etages: 4, casiersParEtage: 6 }
            };

            const [casiersData, setCasiersData] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            const [showConfig, setShowConfig] = React.useState(false);
            const [config, setConfig] = React.useState(CONFIG);

            // G√©n√©rer la liste ordonn√©e des casiers (serpent)
            const genererCasiers = (cfg) => {
                const casiers = [];
                let num = 1;

                // 1. Colonne gauche (du haut vers le bas)
                for (let e = 0; e < cfg.colonneGauche.etageres; e++) {
                    for (let et = 0; et < cfg.colonneGauche.etages; et++) {
                        for (let c = 0; c < cfg.colonneGauche.casiersParEtage; c++) {
                            casiers.push({ num, zone: 'gauche', etagere: e, etage: et, casier: c });
                            num++;
                        }
                    }
                }

                // 2. Rang√©es du milieu (serpent)
                for (let r = 0; r < cfg.rangeesMilieu.nb; r++) {
                    const descendre = r % 2 === 0;
                    const etageres = Array.from({length: cfg.rangeesMilieu.etageresParRangee}, (_, i) => i);
                    const ordered = descendre ? etageres : [...etageres].reverse();
                    for (let e of ordered) {
                        for (let et = 0; et < cfg.rangeesMilieu.etages; et++) {
                            for (let c = 0; c < cfg.rangeesMilieu.casiersParEtage; c++) {
                                casiers.push({ num, zone: `milieu_${r}`, etagere: e, etage: et, casier: c });
                                num++;
                            }
                        }
                    }
                }

                // 3. Bas
                for (let e = 0; e < cfg.bas.etageres; e++) {
                    for (let et = 0; et < cfg.bas.etages; et++) {
                        for (let c = 0; c < cfg.bas.casiersParEtage; c++) {
                            casiers.push({ num, zone: 'bas', etagere: e, etage: et, casier: c });
                            num++;
                        }
                    }
                }

                return casiers;
            };

            // Charger les assignations depuis Firebase
            React.useEffect(() => {
                const unsubscribe = window.firebaseOnCasiers((data) => {
                    setCasiersData(data);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            // Initialiser la collection ‚Äî assigner les commandes aux casiers
            const initialiserCollection = async () => {
                const refs = [...new Set(orders.map(o => o.reference))].sort((a, b) => a - b);
                
                // Relire Firebase pour avoir les donn√©es les plus r√©centes
                const currentCasiers = await window.firebaseGetCasiers();
                
                // Commandes d√©j√† assign√©es
                const commandesDejaAssignees = new Set(Object.values(currentCasiers).map(v => String(v.commande)));
                const nouvellesCommandes = refs.filter(r => !commandesDejaAssignees.has(String(r)));

                if (nouvellesCommandes.length === 0) {
                    alert('‚úÖ Toutes les commandes sont d√©j√† assign√©es !');
                    return;
                }

                if (!window.confirm(`Assigner ${nouvellesCommandes.length} nouvelle(s) commande(s) aux casiers ? Les casiers existants ne seront pas modifi√©s.`)) return;
                
                const casiers = genererCasiers(config);
                // Casiers d√©j√† utilis√©s
                const casiersUtilises = new Set(Object.values(currentCasiers).map(v => v.casierNum));
                const casiersLibres = casiers.filter(c => !casiersUtilises.has(c.num));
                
                const nouvellesAssignations = {};
                nouvellesCommandes.forEach((ref, i) => {
                    if (casiersLibres[i]) {
                        nouvellesAssignations[`casier_${casiersLibres[i].num}`] = {
                            commande: ref,
                            casierNum: casiersLibres[i].num,
                            allume: false,
                            zone: casiersLibres[i].zone
                        };
                    }
                });

                // Ajouter uniquement les nouvelles assignations sans toucher aux existantes
                await window.firebaseMergeCasiers(nouvellesAssignations);
                alert(`‚úÖ ${nouvellesCommandes.length} nouvelle(s) commande(s) assign√©e(s) aux casiers !`);
            };

            // R√©initialiser
            const reinitialiser = async () => {
                if (!window.confirm('‚ö†Ô∏è R√©initialiser TOUS les casiers ? Cette action efface toutes les assignations.')) return;
                await window.firebaseSaveCasiers({});
                alert('‚úÖ Casiers r√©initialis√©s !');
            };

            // Allumer/√©teindre un casier manuellement
            const toggleCasier = async (casierKey, allume) => {
                await window.firebaseUpdateCasier(casierKey, { allume: !allume });
            };

            if (loading) return <div className="text-center py-20 text-gray-400">‚è≥ Chargement...</div>;

            // Construire la map commande ‚Üí casier
            const commandeVsCasier = {};
            if (casiersData) {
                Object.entries(casiersData).forEach(([key, val]) => {
                    if (val.commande) commandeVsCasier[val.commande] = { ...val, key };
                });
            }

            const casiersList = genererCasiers(config);
            const totalCasiers = casiersList.length;
            const totalCommandes = [...new Set(orders.map(o => o.reference))].length;
            const assignes = Object.keys(commandeVsCasier).length;
            const allumes = Object.values(casiersData).filter(v => v.allume).length;

            return (
                <div className="space-y-6">
                    {/* Header */}
                    <div className="bg-white rounded-xl shadow p-6">
                        <div className="flex justify-between items-start flex-wrap gap-4">
                            <div>
                                <h2 className="text-2xl font-bold text-gray-800">üí° Gestion des Casiers</h2>
                                <p className="text-gray-500 text-sm mt-1">{totalCasiers} casiers ‚Ä¢ {assignes} assign√©s ‚Ä¢ {allumes} allum√©s</p>
                            </div>
                            {isAdmin && (
                                <div className="flex gap-2 flex-wrap">
                                    <button onClick={initialiserCollection} className="px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg text-sm transition">
                                        üöÄ Initialiser collection
                                    </button>
                                    <button onClick={reinitialiser} className="px-4 py-2 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-lg text-sm transition">
                                        üîÑ R√©initialiser
                                    </button>
                                    <button onClick={() => setShowConfig(!showConfig)} className="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold rounded-lg text-sm transition">
                                        ‚öôÔ∏è Config
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* Config panel */}
                        {showConfig && isAdmin && (
                            <div className="mt-4 p-4 bg-gray-50 rounded-lg border">
                                <h3 className="font-semibold mb-3">Configuration des √©tag√®res</h3>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                                    <div>
                                        <label className="block text-gray-600 mb-1">√âtag√®res colonne gauche</label>
                                        <input type="number" value={config.colonneGauche.etageres} onChange={e => setConfig(prev => ({...prev, colonneGauche: {...prev.colonneGauche, etageres: +e.target.value}}))} className="w-full border rounded px-2 py-1" />
                                    </div>
                                    <div>
                                        <label className="block text-gray-600 mb-1">√âtag√®res/rang√©e milieu</label>
                                        <input type="number" value={config.rangeesMilieu.etageresParRangee} onChange={e => setConfig(prev => ({...prev, rangeesMilieu: {...prev.rangeesMilieu, etageresParRangee: +e.target.value}}))} className="w-full border rounded px-2 py-1" />
                                    </div>
                                    <div>
                                        <label className="block text-gray-600 mb-1">Nb rang√©es milieu</label>
                                        <input type="number" value={config.rangeesMilieu.nb} onChange={e => setConfig(prev => ({...prev, rangeesMilieu: {...prev.rangeesMilieu, nb: +e.target.value}}))} className="w-full border rounded px-2 py-1" />
                                    </div>
                                    <div>
                                        <label className="block text-gray-600 mb-1">Casiers/√©tage</label>
                                        <input type="number" value={config.colonneGauche.casiersParEtage} onChange={e => setConfig(prev => ({
                                            colonneGauche: {...prev.colonneGauche, casiersParEtage: +e.target.value},
                                            rangeesMilieu: {...prev.rangeesMilieu, casiersParEtage: +e.target.value},
                                            bas: {...prev.bas, casiersParEtage: +e.target.value}
                                        }))} className="w-full border rounded px-2 py-1" />
                                    </div>
                                </div>
                                <p className="text-gray-400 text-xs mt-2">Total avec cette config : {genererCasiers(config).length} casiers</p>
                            </div>
                        )}
                    </div>

                    {/* Stats rapides */}
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div className="bg-white rounded-xl shadow p-4 text-center">
                            <p className="text-3xl font-bold text-blue-600">{totalCommandes}</p>
                            <p className="text-gray-500 text-sm">Commandes</p>
                        </div>
                        <div className="bg-white rounded-xl shadow p-4 text-center">
                            <p className="text-3xl font-bold text-green-600">{assignes}</p>
                            <p className="text-gray-500 text-sm">Casiers assign√©s</p>
                        </div>
                        <div className="bg-white rounded-xl shadow p-4 text-center">
                            <p className="text-3xl font-bold text-yellow-500">{allumes}</p>
                            <p className="text-gray-500 text-sm">LEDs allum√©es</p>
                        </div>
                        <div className="bg-white rounded-xl shadow p-4 text-center">
                            <p className="text-3xl font-bold text-gray-400">{totalCasiers - assignes}</p>
                            <p className="text-gray-500 text-sm">Casiers libres</p>
                        </div>
                    </div>

                    {/* Liste des casiers allum√©s */}
                    {allumes > 0 && (
                        <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
                            <h3 className="font-bold text-yellow-800 mb-3">üí° Casiers allum√©s ({allumes})</h3>
                            <div className="flex flex-wrap gap-2">
                                {Object.entries(casiersData).filter(([, v]) => v.allume).map(([key, val]) => (
                                    <div key={key} className="flex items-center gap-2 bg-yellow-200 rounded-lg px-3 py-2">
                                        <span className="text-yellow-600 font-bold text-lg">üí°</span>
                                        <div>
                                            <p className="font-bold text-yellow-900">Casier #{val.casierNum}</p>
                                            <p className="text-yellow-700 text-xs">Commande #{val.commande}</p>
                                        </div>
                                        <button onClick={() => toggleCasier(key, val.allume)} className="ml-2 px-2 py-1 bg-yellow-500 hover:bg-yellow-600 text-white text-xs rounded font-semibold">
                                            √âteindre
                                        </button>
                                        <button onClick={() => openOrderRecap(val.commande)} className="px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded font-semibold">
                                            Fiche
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Tableau des assignations */}
                    {assignes > 0 && (
                        <div className="bg-white rounded-xl shadow overflow-hidden">
                            <div className="p-4 border-b">
                                <h3 className="font-bold text-gray-800">üìã Plan des casiers</h3>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-4 py-2 text-left text-gray-600">Casier #</th>
                                            <th className="px-4 py-2 text-left text-gray-600">Commande</th>
                                            <th className="px-4 py-2 text-left text-gray-600">Client</th>
                                            <th className="px-4 py-2 text-left text-gray-600">Statut</th>
                                            <th className="px-4 py-2 text-left text-gray-600">LED</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {Object.entries(casiersData).filter(([, v]) => v.commande).sort((a, b) => a[1].casierNum - b[1].casierNum).map(([key, val]) => {
                                            const orderItems = orders.filter(o => o.reference === val.commande);
                                            const client = orderItems[0]?.client || '‚Äî';
                                            const total = orderItems.length;
                                            const termines = orderItems.filter(o => o.status === 'Termin√©').length;
                                            const pct = total > 0 ? Math.round(termines / total * 100) : 0;
                                            return (
                                                <tr key={key} className={`border-t hover:bg-gray-50 ${val.allume ? 'bg-yellow-50' : ''}`}>
                                                    <td className="px-4 py-2 font-bold text-gray-700">#{val.casierNum}</td>
                                                    <td className="px-4 py-2">
                                                        <span className="text-blue-600 cursor-pointer hover:underline font-semibold" onClick={() => openOrderRecap(val.commande)}>#{val.commande}</span>
                                                    </td>
                                                    <td className="px-4 py-2 text-gray-600">{client}</td>
                                                    <td className="px-4 py-2">
                                                        <div className="flex items-center gap-2">
                                                            <div className="flex-1 bg-gray-200 rounded-full h-2 w-20">
                                                                <div className={`h-2 rounded-full ${pct === 100 ? 'bg-green-500' : 'bg-blue-400'}`} style={{width: `${pct}%`}}></div>
                                                            </div>
                                                            <span className="text-xs text-gray-500">{termines}/{total}</span>
                                                        </div>
                                                    </td>
                                                    <td className="px-4 py-2">
                                                        <button onClick={() => toggleCasier(key, val.allume)} className={`px-3 py-1 rounded-full text-xs font-semibold transition ${val.allume ? 'bg-yellow-200 text-yellow-800 hover:bg-yellow-300' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}>
                                                            {val.allume ? 'üí° Allum√©' : '‚óã √âteint'}
                                                        </button>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    )}

                    {assignes === 0 && (
                        <div className="bg-white rounded-xl shadow p-12 text-center text-gray-400">
                            <p className="text-5xl mb-4">üì¶</p>
                            <p className="text-lg font-semibold">Aucun casier assign√©</p>
                            <p className="text-sm mt-2">Cliquez sur "Initialiser collection" pour assigner les commandes aux casiers</p>
                        </div>
                    )}
                </div>
            );
        }

        // Render
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
